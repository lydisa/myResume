<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<title>视差滚动原理三</title>
	<style>
		body {
			background: #B5D2E8;
			height: 3000px;
			overflow-x: hidden;
		}
		
		.scene {
			position: absolute;
			width: 100%;
			height: 100%;
		}
		
		.bridge img {
			position: fixed;
		}
		
		#scene_back {}
		
		#scene_center {}
		
		#scene_front {}
		
		#bridge_cube_1 {
			width: 172px;
			top: 570px;
			left: 384px;
		}
		
		#bridge_cube_2 {
			width: 172px;
			top: 554px;
			left: 544px;
		}
		
		#bridge_cube_3 {
			width: 172px;
			top: 472px;
			left: 526px;
		}
		
		#bridge_cube_4 {
			width: 172px;
			top: 459px;
			left: 692px;
		}
		
		#bridge_cube_5 {
			width: 172px;
			top: 373px;
			left: 672px;
		}
		
		#bridge_cube_6 {
			width: 172px;
			top: 358px;
			left: 834px;
		}
		
		#bridge_cube_7 {
			width: 172px;
			top: 275px;
			left: 821px;
		}
		
		#bridge_cube_8 {
			width: 172px;
			top: 265px;
			left: 985px;
		}
		
		#bridge_cube_9 {
			width: 172px;
			top: 166px;
			left: 972px;
		}
		
		#bridge_cube_10 {
			width: 172px;
			top: 161px;
			left: 1150px;
		}
		
		#land_cube_1 {
			width: 416px;
			top: 0px;
			left: 1152px;
		}
		
		#land_cube_2 {
			width: 416px;
			top: 602px;
			left: 193px;
		}
		
		#role {
			width: 230px;
			top: -40px;
			left: 1260px;
		}

		#cloud_1{top:600px;left:400px;width:120px}
		#cloud_2{top:456px;left:100px;width:234px}
		#cloud_3{top:30px;left:555px;width:786px}
		#cloud_4{top:222px;left:343px;width:200px}
		#cloud_5{top:400px;left:1187px;width:333px}
		#cloud_6{top:1023px;left:646px;width:555px}

		
		@keyframes myfirst {
			0%{margin-top: 0}
			25% {
				margin-top: 10px
			}
			75% {
				margin-top: -10px
			}
			100%{margin-top: 0}
		}
		
		@keyframes myfirst_rev {
			0%{margin-top: 0}
			25% {
				margin-top: -10px
			}
			75% {
				margin-top: 10px
			}
			100%{margin-top: 0}
		}

		@keyframes tip {
			0%{margin-top: 0}
			12.5% {
				margin-top: -10px
			}
			37.5% {
				margin-top: 10px
			}
			50%{margin-top: 0}
			62.5%{margin-top:-5px}
			87.5%{margin-top:5px}
			100%{margin-top:0}
		}

		@keyframes light{
			from{
				-webkit-transform:scale(1.1);
				-moz-transform:scale(1.1);
				-o-transform:scale(1.1)
				};
				to{
				-webkit-transform:scale(0.5);
				-moz-transform:scale(0.5);
				-o-transform:scale(0.5)
				}
		}
		
		.ani_light{
			animation: light 1s infinite alternate;
			-moz-animation: light 1s infinite alternate;
			/* Firefox */
			-webkit-animation: light 1s infinite alternate;
			/* Safari 和 Chrome */
			-o-animation: light 1s infinite alternate;
		}
		.ani_tip{
			animation: tip 2s  alternate;
			-moz-animation: tip 2s  alternate;
			/* Firefox */
			-webkit-animation: tip 2s  alternate;
			/* Safari 和 Chrome */
			-o-animation: tip 2s  alternate;
		}
		.ani_float {
			animation: myfirst 5s infinite alternate;
			-moz-animation: myfirst 5s infinite alternate;
			/* Firefox */
			-webkit-animation: myfirst 5s infinite alternate;
			/* Safari 和 Chrome */
			-o-animation: myfirst 5s infinite alternate;
		}
		
		.ani_float_re {
			animation: myfirst_rev 5s infinite alternate;
			-moz-animation: myfirst_rev 5s infinite alternate;
			/* Firefox */
			-webkit-animation: myfirst_rev 5s infinite alternate;
			/* Safari 和 Chrome */
			-o-animation: myfirst_rev 5s infinite alternate;
		}
	</style>
	<style id="style-1-cropbar-clipper">

		/* Copyright 2014 Evernote Corporation. All rights reserved. */
		
		.en-markup-crop-options {
			top: 18px !important;
			left: 50% !important;
			margin-left: -100px !important;
			width: 200px !important;
			border: 2px rgba(255, 255, 255, .38) solid !important;
			border-radius: 4px !important;
		}
		
		.en-markup-crop-options div div:first-of-type {
			margin-left: 0px !important;
		}
	</style>
</head>

<body>
		<div class="bg1">
		<img id="cloud_1" src="cloud.png">
		<img id="cloud_2" src="cloud.png">
		<img id="cloud_3" src="cloud.png">
	</div>
	<div class="bg2">
		<img id="cloud_4" src="cloud.png">
		<img id="cloud_5" src="cloud.png">
		<img id="cloud_6" src="cloud.png">
	</div>
	<div class="bridge">
		<img class="ani_float" src="cube_red.png" id="land_cube_1">
		<img src="cube_yellow.png" id="bridge_cube_10">
		<!--<img src="cube.png" id="bridge_cube_9">-->
		<img src="cube_yellow.png" id="bridge_cube_8">
		<!--<img src="cube_red.png" id="bridge_cube_7">-->
		<img src="cube.png" id="bridge_cube_6">
		<!--<img src="cube_red.png" id="bridge_cube_5">-->
		<img src="cube_red.png" id="bridge_cube_4">
		<!--<img src="cube_yellow.png" id="bridge_cube_3">-->
		<img src="cube.png" id="bridge_cube_2">
		<!--<img src="cube.png" id="bridge_cube_1">-->
		<img  src="cube_yellow.png" id="land_cube_2">
		<img class="ani_light" src="light.png" id="role">
	</div>

	<script>
		var imgs = document.querySelectorAll(".bridge img");
		var role = document.getElementById("role");
		var imgMoves = [];
		var docHeight = document.documentElement.clientHeight;
		var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
		var scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;　
		var clientHeight = 0;
		if (document.compatMode == "CSS1Compat") {
			clientHeight = document.documentElement.clientHeight;　　
		} else {
			clientHeight = document.body.clientHeight;　　
		}

		window.onload = function () {
			for (var i = 0; i < imgs.length; i++) {
				var targetTop = imgs[i].offsetTop;
				// var initTop = -imgs[i].offsetHeight - Math.random() * 4000;
				var initTop = -imgs[i].offsetHeight - i * 500;
				imgMoves.push({
					targetTop: targetTop,
					initTop: initTop
				});
				imgs[i].style.top = initTop + 'px';

			}
			var sceneBack = document.getElementById('scene_back'),
				sceneCenter = document.getElementById('scene_center'),
				sceneFront = document.getElementById('scene_front');
			var old_top1 = 0,
				old_top2 = 200,
				old_top3 = 700;

			addEvent(window, 'scroll', onScroll);
			onScroll();
		}

		function onScroll(e) {
			docHeight = document.documentElement.clientHeight;
			scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
			scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;　
			clientHeight = 0;
			if (document.compatMode == "CSS1Compat") {
				clientHeight = document.documentElement.clientHeight;　　
			} else {
				clientHeight = document.body.clientHeight;　　
			}

			if (scrollTop < docHeight * 0.35) {
				rollDown(0,1);
			} else if (scrollTop < docHeight * 0.7) {
				walk(0.35,1);
			} else {
				walk(0.35,1);
			}


		}

		function addEvent(eventTarget, eventType, eventHandler) {
			if (eventTarget.addEventListener) {
				eventTarget.addEventListener(eventType, eventHandler, false);
			} else {
				if (eventTarget.attachEvent) {
					eventType = "on" + eventType;
					eventTarget.attachEvent(eventType, eventHandler);
				} else {
					eventTarget["on" + eventType] = eventHandler;
				}
			}
		}

		function rollDown(beginScrollTopK,endScrollTopK) {
			for (var i = 0; i < imgs.length; i++) {
				var targetTop = imgMoves[i].targetTop;
				var initTop = imgMoves[i].initTop;
				//k为当前滚动条的位置占指定的开始到结束区间的百分比
				var k = (scrollTop / (docHeight - clientHeight)-beginScrollTopK)/(endScrollTopK-beginScrollTopK);
				imgs[i].style.top = (targetTop - initTop) * k * 2 + initTop;
			}
		}

		function walk(beginScrollTopK,endScrollTopK) {
			var k = (scrollTop / (docHeight - clientHeight)-beginScrollTopK)/(endScrollTopK-beginScrollTopK);
			//当前小球跳向的方块元素索引
			var i = Math.floor(k*imgs.length);
			//目前小球跳向目标方块的动画播放进度百分比
			var del = k*imgs.length-i;
			del = del.toFixed(2);
			if(del>0.8&&del<0.9&&!imgMoves[i].playing){
				imgs[i].classList.add("ani_tip");
				imgMoves[i].playing = true;
				setTimeout(function(){removeAni(i,"ani_tip");},2000)
			}
			//小球上一个目标方块距离当前目标方块的相对坐标计算
			var width = imgs[i].offsetLeft-imgs[i-1].offsetLeft;
			var height = imgs[i].offsetTop-imgs[i-1].offsetTop;
			//下一帧动画的相对X轴位移
			var x  = width*del;
			//抛物线运动计算公式：y = a*x*x + b*x + c a为指定常数 c为0 要先算出b才能求出目前x轴位移对应的y轴位移
			var a = 0.015;
			var b = (height-a*width*width)/width;
			var y = a*x*x+b*x;
			role.style.left=imgs[i-1].offsetLeft-50+width*del;
			role.style.top=imgs[i-1].offsetTop-135+y;
			console.log("x:"+x+" 垂直位移:"+y)
		}

		function removeAni(i,aniClass){
			console.log(i)
			imgs[i].classList.remove(aniClass);
			imgMoves[i].playing=false;
		}
	</script>


	<div id="NiuniuCaptureEvent" style="display: none;"></div>
</body>

</html>